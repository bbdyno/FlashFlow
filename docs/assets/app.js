const translations = {
  en: {
    nav_features: "Features",
    nav_support: "Support",
    nav_store: "App Store",
    lang_label: "Language",
    hero_badge: "Launching on the App Store",
    hero_title_1: "Study Smarter",
    hero_title_2: "with science-backed reviews.",
    hero_sub: "FlashForge combines SM-2 and FSRS to optimize spaced repetition and help you retain more with less effort.",
    hero_desc: "100% offline-first. Your study data stays on your device.",
    cta_appstore: "View on App Store",
    cta_github: "View on GitHub",
    cta_support: "Support Development",
    trust_1: "SM-2 + FSRS Hybrid",
    trust_2: "Offline-First Privacy",
    trust_3: "Deck/Review Analytics",
    mock_sub: "Smart flashcards for focused study",
    mock_stat_1: "Due cards",
    mock_stat_2: "Review streak",
    mock_stat_3: "Retention",
    features_title: "Everything for deliberate flashcard learning",
    features_sub: "From algorithm-driven scheduling to smooth review flows, built for daily learners.",
    f1_title: "Hybrid Scheduling",
    f1_desc: "Combine proven SM-2 with modern FSRS for adaptive, retention-focused intervals.",
    f2_title: "Deck & Card Management",
    f2_desc: "Create unlimited decks, rich cards, and organize your content for focused sessions.",
    f3_title: "4-Grade Feedback",
    f3_desc: "Rate each review as Again, Hard, Good, or Easy for precise next scheduling.",
    f4_title: "Review Analytics",
    f4_desc: "Track progress with due summaries, card states, and long-range heatmap insights.",
    f5_title: "Backup & Restore",
    f5_desc: "Export and import your decks and review history as portable backup files.",
    f6_title: "Privacy by Design",
    f6_desc: "No account, no server sync by default, and no forced data collection.",
    flow_title: "How FlashForge fits your study routine",
    flow_1_title: "Create",
    flow_1_desc: "Build decks and cards for topics you actually want to remember.",
    flow_2_title: "Review",
    flow_2_desc: "Use the hybrid scheduler and 4-grade feedback to optimize intervals.",
    flow_3_title: "Retain",
    flow_3_desc: "Track streaks and heatmaps to maintain consistency over the long term.",
    support_title: "Support the developer",
    support_sub: "FlashForge is built independently. Your support helps keep updates shipping.",
    support_coffee_title: "Buy Me a Coffee",
    support_coffee_btn: "Open Support Page",
    support_crypto_title: "Crypto Donation",
    copy_btn: "Copy",
    copy_done: "Copied to clipboard",
    footer_rights: "© 2026 FlashForge. All rights reserved.",
    footer_contact: "Contact",
    footer_terms: "Terms",
    footer_privacy: "Privacy"
  },
  ko: {
    nav_features: "주요 기능",
    nav_support: "후원",
    nav_store: "앱스토어",
    lang_label: "언어",
    hero_badge: "App Store 출시 예정",
    hero_title_1: "더 똑똑하게 학습하고",
    hero_title_2: "더 오래 기억하세요.",
    hero_sub: "FlashForge는 SM-2와 FSRS를 결합해 간격 반복을 최적화하고, 더 적은 노력으로 더 높은 기억 유지율을 돕습니다.",
    hero_desc: "100% 오프라인 우선. 학습 데이터는 기기에 저장됩니다.",
    cta_appstore: "App Store 보기",
    cta_github: "GitHub 보기",
    cta_support: "개발 후원하기",
    trust_1: "SM-2 + FSRS 하이브리드",
    trust_2: "오프라인 우선 프라이버시",
    trust_3: "덱/복습 분석",
    mock_sub: "집중 학습을 위한 스마트 플래시카드",
    mock_stat_1: "복습 대기 카드",
    mock_stat_2: "연속 학습",
    mock_stat_3: "기억 유지율",
    features_title: "의도적인 플래시카드 학습에 필요한 모든 기능",
    features_sub: "알고리즘 기반 스케줄링부터 부드러운 복습 흐름까지, 매일 학습하는 사용자를 위해 설계했습니다.",
    f1_title: "하이브리드 스케줄링",
    f1_desc: "검증된 SM-2와 최신 FSRS를 결합해 적응형 복습 간격을 제공합니다.",
    f2_title: "덱/카드 관리",
    f2_desc: "무제한 덱과 풍부한 카드 구성을 통해 학습 콘텐츠를 체계적으로 관리합니다.",
    f3_title: "4단계 피드백",
    f3_desc: "Again, Hard, Good, Easy 평가로 다음 복습 시점을 정밀하게 계산합니다.",
    f4_title: "복습 분석",
    f4_desc: "복습 요약, 카드 상태, 장기 히트맵으로 학습 진도를 확인하세요.",
    f5_title: "백업/복원",
    f5_desc: "덱과 복습 기록을 내보내고 가져와 손쉽게 데이터 이관이 가능합니다.",
    f6_title: "프라이버시 중심 설계",
    f6_desc: "기본은 무계정/무서버이며, 강제 데이터 수집이 없습니다.",
    flow_title: "FlashForge 학습 루틴",
    flow_1_title: "생성",
    flow_1_desc: "기억하고 싶은 주제로 덱과 카드를 만드세요.",
    flow_2_title: "복습",
    flow_2_desc: "하이브리드 스케줄러와 4단계 피드백으로 간격을 최적화하세요.",
    flow_3_title: "유지",
    flow_3_desc: "스트릭과 히트맵으로 꾸준한 장기 학습을 유지하세요.",
    support_title: "개발자 후원",
    support_sub: "FlashForge는 1인 개발 프로젝트입니다. 후원이 업데이트 지속에 큰 도움이 됩니다.",
    support_coffee_title: "커피로 후원하기",
    support_coffee_btn: "후원 페이지 열기",
    support_crypto_title: "암호화폐 후원",
    copy_btn: "복사",
    copy_done: "클립보드에 복사되었습니다",
    footer_rights: "© 2026 FlashForge. All rights reserved.",
    footer_contact: "문의",
    footer_terms: "이용약관",
    footer_privacy: "개인정보처리방침"
  }
};

const langSelect = document.getElementById("langSelect");
const toastEl = document.getElementById("toast");
let currentLang = "en";
let toastTimer = null;

function t(key) {
  return translations[currentLang]?.[key] ?? translations.en[key] ?? key;
}

function applyLanguage(lang) {
  currentLang = translations[lang] ? lang : "en";
  document.documentElement.lang = currentLang;

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const value = t(key);
    if (value) {
      el.textContent = value;
    }
  });

  if (langSelect) {
    langSelect.value = currentLang;
  }
  localStorage.setItem("flashforge_lang", currentLang);
}

function showToast(message) {
  if (!toastEl) {
    return;
  }

  toastEl.textContent = message;
  toastEl.classList.add("show");

  if (toastTimer) {
    clearTimeout(toastTimer);
  }

  toastTimer = setTimeout(() => {
    toastEl.classList.remove("show");
  }, 1800);
}

async function copyText(text) {
  if (navigator.clipboard && window.isSecureContext) {
    await navigator.clipboard.writeText(text);
    return;
  }

  const temp = document.createElement("textarea");
  temp.value = text;
  temp.setAttribute("readonly", "");
  temp.style.position = "absolute";
  temp.style.left = "-9999px";
  document.body.appendChild(temp);
  temp.select();
  document.execCommand("copy");
  document.body.removeChild(temp);
}

function setupCopyButtons() {
  document.querySelectorAll(".copy-btn").forEach((button) => {
    button.addEventListener("click", async () => {
      const targetId = button.getAttribute("data-copy-target");
      const target = targetId ? document.getElementById(targetId) : null;
      if (!target) {
        return;
      }

      try {
        await copyText(target.textContent.trim());
        showToast(t("copy_done"));
      } catch (error) {
        showToast("Copy failed");
      }
    });
  });
}

function setupRevealAnimations() {
  const revealTargets = document.querySelectorAll(".reveal");
  if (revealTargets.length === 0) {
    return;
  }

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("is-visible");
        }
      });
    },
    { threshold: 0.12 }
  );

  revealTargets.forEach((el) => observer.observe(el));
}

function setupLanguageSelector() {
  if (!langSelect) {
    return;
  }

  langSelect.addEventListener("change", (event) => {
    applyLanguage(event.target.value);
  });

  const saved = localStorage.getItem("flashforge_lang");
  const browser = navigator.language?.split("-")[0] ?? "en";
  const initialLang = saved || (translations[browser] ? browser : "en");
  applyLanguage(initialLang);
}

setupLanguageSelector();
setupCopyButtons();
setupRevealAnimations();
